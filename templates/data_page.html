<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>

    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>data page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .sidebar {
            height: 100%;
            width: 160px;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            padding-top: 16px;
        }

        .sidebar a {
            padding: 6px 8px 6px 16px;
            text-decoration: none;
            font-size: 30px;
            color: rgb(82,66,54);
            display: block;
        }

        .sidebar a:hover {
            color: grey;
        }

        .data {
            margin-left: 160px;
            padding: 0px 10px;
        }

        @media screen and (max-height:450px) {
            .sidebar {
                padding-top: 15px;
            }

            .sidebar a {
                font-size: 18px;
            }
        }

        .breath{
            height: 300px;
            width: 600px;
            background-color:white;
        }

        .breath_count{
            position: absolute;
            top: 100px;
            left: 300px;
        }
        
        .heart_title{
            position: absolute;
            top: 1px;
            right: 290px;
        }

        .heart_count{
            position: absolute;
            top: 30px;
            right: 120px;
        }

        .rate{
            position: absolute;
            top: 70px;
            right: 90px;
            height: 300px;
            width: 600px;
            background-color:white;      
        }

        .quality{
            height: 300px;
            width: 1200px;
            background-color:white;
        }

        .quality_depth{
            position: absolute;
            top: 450px;
            left: 300px;    
        }

        .quality_freq{
            position: absolute;
            top: 475px;
            right: 200px;
        }

        @import url("https://fonts.googleapis.com/css?family=Roboto:100,400");

        body {
            background: #2f2f2f;
        }

        .background-half-round {
            width: 300px;
            height: 150px;
            background: #232323;
            margin: auto;
            border-radius: 300px 300px 0 0;
            border: 10px solid #f8f8f8;
            border-bottom: 0;
            box-shadow: inset 0 2px 5px #151515;
            position: relative;
        }

        .background-half-round:after {
            content: "";
            width: 50px;
            height: 25px;
            position: absolute;
            background: #2f2f2f;
            display: block;
            top: auto;
            bottom: 0;
            border-radius: 50px 50px 0 0;
            box-shadow: inset 0px 3px 5px 0px #151515;

            z-index: 5;
            margin: auto;
            left: 0;
            right: 0;
        }

        .speed-number-wapper {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .speed-number {
            color: #fff;
            font-family: "Roboto";
        }

        .speed-number span:after {
            content: "";
            width: 2px;
            height: 5px;
            background: #fff;
            position: relative;
        }

        .speed-60,
        .speed-100,
        .speed-120,
        .speed-160 {
            position: absolute;
            bottom: 0;
            width: 50%;
        }
        .speed-60 span {
            padding: 0px 0px 0px 5px;
        }

        .speed-100 {
            transform: rotate(45deg);
            transform-origin: 100% 0%;
        }

        .speed-100 span {
            transform: rotate(-45deg);
            display: inline-block;
            padding: 15px 0px 0px 15px;
        }

        .speed-110 {
            margin: auto;
            text-align: center;
        }

        .speed-120 {
            transform: rotate(135deg);
            transform-origin: 100% 25%;
        }

        .speed-120 span {
            transform: rotate(-135deg);
            display: inline-block;
            padding: 0px 15px 0px 15px;
            color: #ff4141;
            font-weight: bold;
        }

        .speed-160 {
            transform: rotate(180deg);
            transform-origin: 100% 50%;
        }

        .speed-160 span {
            transform: rotate(-180deg);
            display: inline-block;
            padding: 0px 5px 0px 0px;
            color: #ff4141;
            font-weight: bold;
        }

        .dashboard-icon{
            width:20px;
        }

        .dashboard-icon svg{
            fill: #4b4b4b;
            position: absolute;
            max-width: 45px;
            margin: auto;
            bottom: 15px;
            left: 70px;
        }

        .dashboard-icon svg:hover{
            fill: #ff4141;
        }


        /*指針*/
        .pointer {
            background: #ffa500;
            width: 8px;
            height: 140px;
            border-radius: 10px;
            transform: rotate(-90deg);
            -ms-transform: rotate(-90deg); /*IE 9*/
            -ms-transform-orgin: 50% 100%; /*IE 9*/
            -webkit-transform: rotate(-90deg); /*safari 3-8*/
            -webkit-transform-orgin: 50% 100%; /*safari 3-8*/
            margin: auto;
            transform-origin: 50% 100%;
        }

        .speed-ani {
            animation: speeding  5s infinite alternate;
        }

        @keyframes speeding {
            0% {
                transform: rotate(-90deg);
            }
            5% {
                transform: rotate(-85deg);
            }
            80% {
                transform: rotate(80deg);
            }
            85% {
                transform: rotate(85deg);
            }
            90% {
                transform: rotate(80deg);
            }
            95% {
                transform: rotate(90deg);
            }
            97% {
                transform: rotate(90deg);
            }
            100% {
                transform: rotate(92deg);
            }
        }
    </style>
</head>

<body style="background-color:rgb(255,248,229);">
    <div class="sidebar" style="background-color:white">
        <img src="{{url_for('static', filename='/0ltw0Lm.jpg')}}" width="130" height="100" class="center">
        <a href="index.php"><i class="fa fa-fw fa-home"></i> 首頁</a>
        <a href="#"><i class="fa fa-fw fa-bar-chart"></i> 數據</a>
        <a href="#"><i class="fa fa-fw fa-cog"></i> 設定</a>
    </div>

    <div class="data" >
        <h2 style="color:rgb(82,66,54);">呼吸狀況</h2>
        <div class="breath">
            <div id="bar_breath" style="width:600px; height:300px;"></div>
        </div>

        <h2 class="heart_title" style="color:rgb(82,66,54);">心跳狀況</h2>
        <div class="rate">
            <div id="bar_rate" style="width:600px; height:300px;"></div>
            <!-- <div style="text-align:right" class="float_left">
                <img src="{{url_for('static', filename='/9YpGuIX.jpg')}}"  alt="heart" width="100" height="100">
            </div>
            <div class="heart_count">
                <h2 style="color:rgb(82,66,54);">{{HtmlVar_HeartRate}} 次/分</h2>
            </div> -->
        </div>
        
        <h2 style="color:rgb(82,66,54);">按壓品質</h2>
        <div class="quality">
            <div class="quality_depth">
                <div id="bar_depth" style="width:600px; height:300px;"></div>
            </div>
            <div class="quality_freq">
                <div id="bar_freq" style="width:400px; height:300px;"></div>
            </div>

            <!-- <div class="background-half-round">
                <div class="speed-number-wapper">
                    <div class="speed-number speed-60">
                        <span>60</span>
                    </div>
                    <div class="speed-number speed-100">
                        <span>100</span>
                    </div>
                    <div class="speed-number speed-110">
                        <span>110</span>
                    </div>
                    <div class="speed-number speed-120">
                        <span>120</span>
                    </div>
                    <div class="speed-number speed-160">
                        <span>160</span>
                    </div>
                </div>
                <div class="dashboard-icon">
                    <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 224.75 93.52"><path d="" transform="translate(-10.19 -1.92)"/></svg>
                </div>
                <div class="pointer speed-ani"></div>
            </div> -->
        </div>
    </div>
</body>

<script>
    var chart_breath = echarts.init(document.getElementById('bar_breath'), 'white', {renderer: 'canvas'});
    var chart_rate = echarts.init(document.getElementById('bar_rate'), 'white', {renderer: 'canvas'});
    var chart_freq = echarts.init(document.getElementById('bar_freq'), 'white', {renderer: 'canvas'});
    var chart_depth = echarts.init(document.getElementById('bar_depth'), 'white', {renderer: 'canvas'});
    
    var history_breath = [];
    var history_rate = [];
    var HISTORY_LENGTH = 1000;
    
    $(
        function () {
            fetch_LineGraph();
            fetch_GaugeGraph();
            fetch_BarGraph();
            setInterval(getDynamicData, 100);
        }
    );

    function fetch_LineGraph() {
        $.ajax({
            type: "GET",
            url: "https://128b-1-200-12-1.ngrok.io/lineChart",
            dataType: "json",
            success: function (result) {
                chart_breath.setOption(result);
                history_breath = chart_breath.getOption().series[0].data;

                chart_rate.setOption(result);
                history_rate = chart_rate.getOption().series[0].data;
            }
        });
    }

    function fetch_GaugeGraph() {
        $.ajax({
            type: "GET",
            url: "https://128b-1-200-12-1.ngrok.io/gaugeChart",
            dataType: "json",
            success: function (result) {
                chart_freq.setOption(result);
            }
        });
    }

    function fetch_BarGraph() {
        $.ajax({
            type: "GET",
            url: "https://128b-1-200-12-1.ngrok.io/barChart",
            dataType: "json",
            success: function (result) {
                chart_depth.setOption(result);
            }
        });
    }

    function getDynamicData() {
        $.ajax({
            type: "GET",
            url: "https://128b-1-200-12-1.ngrok.io/getDynamicData",
            dataType: "json",
            success: function (result) {
                history_breath.push([result.name, result.Breath_Freq]);
                if (history_breath.length > HISTORY_LENGTH) {
                    history_breath.shift();
                }
                chart_breath.setOption({
                    series: [{data: history_breath}]
                });

                history_rate.push([result.name, result.HeartRate]);
                if (history_rate.length > HISTORY_LENGTH) {
                    history_rate.shift();
                }
                chart_rate.setOption({
                    series: [{data: history_rate}]
                });
                
                var tmp = [result.CPR_Freq]
                chart_freq.setOption({
                    series: [{data: tmp}]
                })

                var tmp = [result.CPR_Depth]
                chart_depth.setOption({
                    series: [{data: tmp}]
                })
            }
        });
    }

</script>

</html>